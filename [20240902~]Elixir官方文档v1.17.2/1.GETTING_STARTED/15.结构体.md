# [Structs](https://github.com/elixir-lang/elixir/blob/v1.17.2/lib/elixir/pages/getting-started/structs.md#L1)

`struct` 构建在`map`之上，提供编译时检测和默认值。

## 定义

使用`defstruct/1`定义结构体,后面紧跟他的属性和默认值。
使用`%ModuleName{}`创建

```elixir
# 定义User结构体
defmodule User do
    defstruct name: "John", age: 27
end

# 创建User
%User{}

# 只允许在struct中定义的属性
# gender属性不存在，会报错
iex> %User{gender: :field}
** (KeyError) key :oops not found expanding struct: User.__struct__/1
```

## 访问和更新结构体

结构体访问和更新属性的语法与`maps`相同。

```elixir

iex(1)> defmodule User do
...(1)>    defstruct name: "John", age: 27
...(1)> end

iex(2)> j = %User{}
%User{name: "John", age: 27}
iex(3)> j.name
"John"
iex(4)> l = %{j | name: "Lucas"}
%User{name: "Lucas", age: 27}


# 结构体也可以用于类型匹配，会匹配他的类型和值
iex(5)> %User{name: name} = j
%User{name: "John", age: 27}
iex(6)> name
"John"
iex(7)> %User{} =%{}
** (MatchError) no match of right hand side value: %{}
    (stdlib 6.0.1) erl_eval.erl:652: :erl_eval.expr/6
    iex:7: (file)

```

## 结构体实际是一个map

结构体实际是map，只是多了一个特殊的属性`__struct__`，存储了结构体名字.
但是结构体不继承maps的任何协议，你无法枚举或者访问结构体。

```elixir
iex(8)> is_map(%User{})
true
iex(9)> j.__struct__
User

# 未继承maps的protocl
iex(10)> j[:name]
** (UndefinedFunctionError) function User.fetch/2 is undefined (User does not implement the Access behaviour

You can use the "struct.field" syntax to access struct fields. You can also use Access.key!/1 to access struct fields dynamically inside get_in/put_in/update_in)
    User.fetch(%User{name: "John", age: 27}, :name)
    (elixir 1.17.2) lib/access.ex:322: Access.get/3
    iex:10: (file)
iex(10)> Enum.each(j,&(IO.puts([&1,&2])))
** (Protocol.UndefinedError) protocol Enumerable not implemented for %User{name: "John", age: 27} of type User (a struct)
    (elixir 1.17.2) lib/enum.ex:1: Enumerable.impl_for!/1
    (elixir 1.17.2) lib/enum.ex:166: Enumerable.reduce/3
    (elixir 1.17.2) lib/enum.ex:4423: Enum.each/2
    iex:10: (file)
iex(10)> 
```

结构体提供了一个特别重要的特性，叫做多态。

## 默认值和必须值

如果不指定默认值，则值是`nil`

```elixir
iex(10)> defmodule Product do
...(10)>   defstruct [:name]
...(10)> end

iex(12)> %Product{}
%Product{name: nil}

```

同时定义带默认值和不带默认值的结构体时，需要先定义不带默认值的属性。

```elixir
defmodule User do
    defstruct [:name, :email, age: 27]
end
```

通过`@enforce_keys`指定在创建struct时，必须赋值。

```elixir
defmodule Car do
    @enforce_keys [:make]
    defstruct [:make, :model]
end

iex(15)> %Car{}
** (ArgumentError) the following keys must also be given when building struct Car: [:make]
    expanding struct: Car.__struct__/1
    iex:15: (file)
iex(15)> 
```




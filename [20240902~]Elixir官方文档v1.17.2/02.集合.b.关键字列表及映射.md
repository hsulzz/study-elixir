# 关键字列表及映射

`Elixir`中主要有2中关联数据结构，`keyword lists` 和 `maps`

## 关键字列表

关键字列表 是一种用于给函数传递`options`的数据结构。

他有三个重要特性：
- 键 必须是 `atom`
- 键 是有序的
- 键 可以定义多次

```elixir
# [trim: true]是一个关键字列表，当他作为函数的最后一个参数时，可以省略[]
 String.split("1  2  3", " ", trim: true)
["1", "2", "3"]

```

关键字列表 实际上是一个简单的列表中包含了一个二元组，元组的第一个元素是`atom`,第二个元素可以是任意类型。

```elixir
 iex(9)> [{:trim, true}] == [trim: true]
true

# 因为 关键字列表是 列表，可以使用所有list的操作
iex(10)> list = [a: 1, b: 2]
[a: 1, b: 2]
iex(11)> list ++ [c: 3]
[a: 1, b: 2, c: 3]

# 可以使用 []访问值
iex(12)> list[:a]
1
```

## do代码块与关键词列表

```elixir
# 下面两段代码等价,使用关键字列表可以把代码写到一行
if true do
  "This will be seen"
else
  "This won't"
end

if true, do: "This will be seen", else: "This won't"

```

## 映射 键值对

`Elixir`中存储键值对用`map`,用`%{}`来表示。
相较于 关键字列表，map有以下区别。
- `map`允许任何值做键
- `map`的键是无序的
- `map`与`keyword list`相反，非常适合模式匹配，`map`总会匹配给定值的子集

```elixir
# 匹配子集
iex(3)> %{:a => a} = %{:a => 1, 2 => :b}
%{2 => :b, :a => 1}
iex(4)> a
1
iex(5)> %{:c => c} = %{:a => 1, 2 => :b}
** (MatchError) no match of right hand side value: %{2 => :b, :a => 1}
    (stdlib 6.0.1) erl_eval.erl:652: :erl_eval.expr/6
    iex:5: (file)

# 空map与任何map匹配
iex(5)> %{} = %{:a => 1, 2 => :b}
%{2 => :b, :a => 1}

# key都是atom的map ，可以写成`key: value`的形式
iex(1)> %{:a => 1, :b =>2}
%{b: 2, a: 1}

# 当key是atom时，可以以`map.key`的形式访问值,非atom 则需要以map[:key]的形式访问
iex(4)> map = %{name: "John", age: 23}
%{name: "John", age: 23}
iex(5)> map.name
"John"
iex(6)> map[:name]
"John"

# 更新map的值
iex(7)> %{map | name: "Mary"}
%{name: "Mary", age: 23}

# 不能更新map中不存在的key
iex(8)> %{map | agee: 27}
** (KeyError) key :agee not found in: %{name: "John", age: 23}.
```

## 嵌套数据结构

`map`中可以嵌套`map`，也可以嵌套`keyword list`，
`Elixir`提供了很很多方法操作嵌套数据结构，如`get_in/1`,`put_in/2`,`update_in/2`等

```elixir
iex(10)> users = [  
    john: %{name: "John", age: 27, languages: ["Erlang", "Ruby", "Elixir"]},  mary: %{name: "Mary", age: 29, languages: ["Elixir", "F#", "Clojure"]}
    ]

# 访问john的age
iex(11)> users[:john].age
27

# 使用put_in修改john的age
iex(14)> users = put_in users[:john].age, 31
[
  john: %{name: "John", age: 31, languages: ["Erlang", "Ruby", "Elixir"]},
  mary: %{name: "Mary", age: 29, languages: ["Elixir", "F#", "Clojure"]}
]
```
## 总结

`Elixir`提供了`keyword list`和`map`存储键值对，`Access`模块和模式匹配提供了一套丰富的工具区操作复杂嵌套数据结构。

- 使用`keyword map` 为函数传递可选参数
- `map`用于通用的键值数据结构
- 预定义的key的数据，使用`map`